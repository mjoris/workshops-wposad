<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>WPoSaD – Course materials</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
    <link rel="stylesheet" href="main.css">
    <style>
        .reveal ul.arrow {
            list-style-type: none;
            font-size: 80%;
            margin: 0;
            margin-left: 1.25em;
            padding: 0;
        }

        .reveal ul.arrow li {
            padding-bottom: 0;
            margin: 0;
            line-height: 1.2em;
        }
        .reveal ul.arrow li:before {
            content: '⟶ ';
        }
    </style>
</head>

<body>

<div class="reveal">

    <div class="slides">
        <section data-background="#4d7e65">
            <h3>Web Programming on Servers and Devices <small>[OGI03<span style="text-transform: lowercase;">v</span>]</small></h3>
            <h1>09. Some more<br>Javascript</h1>
            <footer><small>Slides by: <em>Bart Delrue</em> &nbsp;&bullet;&nbsp; Composition and updates: <em>Joris Maervoet</em></small></footer>
        </section>

        <section>
            <section>
                <h2>09.1<br>Arrow functions</h2>
            </section>
            <section>
                <h2>Arrow function break down (1)</h2>
                <pre><code class="language-javascript">// Traditional Anonymous Function
function (a) {
  return a + 100;
};

// Arrow Function Break Down

// 1. Remove the word "function" and place arrow between the argument and opening body bracket
(a) =&gt; {
  return a + 100;
};

// 2. Remove the body braces and word "return" — the return is implied.
(a) =&gt; a + 100;

// 3. Remove the argument parentheses
a =&gt; a + 100;</code></pre>
                <footer><small>Source: <a
                        href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions">Javascript | MDN</a></small></footer>
            </section>
            <section>
                <h2>Arrow function break down (2)</h2>
                <pre><code contenteditable class="language-javascript overlayrun">// Traditional Function
let add = function (a) {
  return a + 100;
};
console.log(add(1));

// Arrow Function Break Down

// 1. Remove the word "function" and place arrow between the argument and opening body bracket
add = (a) =&gt; {
  return a + 100;
};
console.log(add(2));

// 2. Remove the body braces and word "return" — the return is implied.
add = (a) =&gt; a + 100;
console.log(add(3));

// 3. Remove the argument parentheses
add = a =&gt; a + 100;
console.log(add(4));</code></pre>
            </section>
        </section>


        <section>
            <section>
                <h2>09.2<br>Array methods</h2>
            </section>
            <!--section data-background="#fdfdfd">
                <h2>Document Object Model: Intro (1)</h2>
                <q>The Document Object Model (DOM) is the data representation of the objects that comprise the structure
                    and content web page, such that it can be inspected/manipulated by a Javascript program</q>
            </section-->
            <section>
                <h2>Add/remove items</h2>
                <p>push, unshift, pop, shift</p>
                <pre><code contenteditable class="language-javascript overlayrun">const arr = [1,2,3];

arr.push(4);      // adds item to the end
console.log(arr); // arr = [1,2,3,4]

arr.unshift(0);   // adds items to the beginning
console.log(arr); // arr = [0,1,2,3,4]

const last = arr.pop(); // removes an item from the end
console.log(arr);      // -&gt; arr = [0,1,2,3]
console.log(last);     // -&gt; last = 4

const first = arr.shift(); // removes an item from the beginning
console.log(arr);         // -&gt; arr = [1,2,3]
console.log(first);       // -&gt; first = 0</code></pre>
            </section>
            <section>
                <h2>Replace, combine and extract</h2>
                <p>splice, concat*, slice*</p>
                <pre><code contenteditable class="language-javascript overlayrun">const arr = [0,1,2,3,4,5,6,7,8,9]

// remove the third, forth and fifth item
let newArr = arr.splice(2,3);
console.log(arr);         // -&gt; arr = [0,1,5,6,7,8,9]
console.log(newArr);      // -&gt; newArr = [2,3,4]

// extra: can replace items!
newArr = arr.splice(2,3, "vijf", "zes");
console.log(arr);         // -&gt; arr = [0,1,"vijf","zes",8,9]
console.log(newArr);    // -&gt; extraArr = [5,6,7]

const arrOne = [0,1,2,3];
const arrTwo = [4,5,6]
const arrCombined = arrOne.concat(arrTwo);
console.log(arrOne);      // -&gt; arrOne = [0,1,2,3]
console.log(arrTwo);      // -&gt; arrTwo = [4,5,6]
console.log(arrCombined); // -&gt; arrCombined =  [0,1,2,3,4,5,6]

newArr = arrCombined.slice(0,2);
console.log(arrCombined); // -&gt; arrCombined =  [0,1,2,3,4,5,6]
console.log(newArr);      // -&gt; newArr = [0,1]
</code></pre>
                <footer><small>* does not modify the original array</small></footer>
            </section>
            <section>
                <h2>Recap #1</h2>
                <table>
                    <tr>
                        <td>push</td>
                        <td>add to end<br></td>
                    </tr>
                    <tr>
                        <td>unshift<br></td>
                        <td>add to start</td>
                    </tr>
                    <tr>
                        <td>pop<br></td>
                        <td>remove from end<br></td>
                    </tr>
                    <tr>
                        <td>shift<br></td>
                        <td>remove from start</td>
                    </tr>
                    <tr>
                        <td>splice<br></td>
                        <td>remove (and/or replace) multiple</td>
                    </tr>
                    <tr>
                        <td>concat<br></td>
                        <td>combine into new</td>
                    </tr>
                    <tr>
                        <td>slice<br></td>
                        <td>extract multiple into new</td>
                    </tr>
                </table>
            </section>
            <section>
                <h2>Higher order functions (1)</h2>
                <p>forEach(): do something <strong>for</strong> every element</p>
                <pre><code contenteditable class="language-javascript overlayrun">const arr = [1,2,3];

// do something for every value in the array
// with an arrow function
arr.forEach((value) =&gt; { console.log(value) });

// with an anonymous function
arr.forEach(function(value) { console.log(value); });

// with a predefined function expression
const doSomething = function(value) { console.log(value); };
arr.forEach(doSomething); // no () !

                </code></pre>
            </section>
            <section>
                <h2>Higher order functions (2)</h2>
                <p>find(), filter(), every()</p>
                <pre><code contenteditable class="language-javascript overlayrun">const arr = [
    { name: "John" }, { name: "Paul" },
    { name: "George" }, { name: "Ringo" }
];

// check a condition for every item
// if the result is true -&gt; return that item
let beatleRingo = arr.find( v =&gt; v.name === "Ringo");
console.log(beatleRingo); // -&gt; result = { name: "Ringo" }

// check a condition for every item
// if the result is true -&gt; include that item in the result
let beatlesWithO = arr.filter(v =&gt; v.name.includes("o"))
console.log(beatlesWithO);

// check a condition for every item
// if the result is true for every item → return true
haveAllBeatlesO = arr.every(v =&gt; v.name.includes("o"))
console.log(haveAllBeatlesO);
</code></pre>
            </section>
            <section>
                <h2>Recap #2</h2>
                <p>These methods do not change the original array</p>
                <table>
                    <tbody>
                    <tr>
                        <td>foreach</td>
                        <td>do something for every item</td>
                    </tr>
                    <tr>
                        <td>find<br></td>
                        <td>find one item, based on a condition</td>
                    </tr>
                    <tr>
                        <td>filter<br></td>
                        <td>find multiple items, based on a condition</td>
                    </tr>
                    <tr>
                        <td>every<br></td>
                        <td>is a condition true for every item?</td>
                    </tr>
                    </tbody>
                </table>
            </section>
            <section>
                <h2>Want some more?</h2>
                <p>sort(), reverse(), map()</p>
                <pre><code contenteditable class="language-javascript overlayrun">const arr = [5, 8, 9, 1, 0, 2];

arr.sort((a, b) =&gt; {
  if (a &gt; b) return 1;
  if (a === b) return 0;
  if (a < b) return -1;
});
console.log(arr); // -&gt; arr = [0, 1, 2, 5, 8, 9]
arr.reverse();
console.log(arr); // -&gt; arr = [9, 8, 5, 2, 1, 0]

const beatles = [ { name: "John" }, { name: "Paul" }, { name: "George" }, { name: "Ringo" }];

// modify every item AND return
const newArr = beatles.map(v =&gt; {
    v.isBeatle = true;
    return v;
});
// WARNING! You have changed the original objects in arr too!
// Because objects are by reference.
console.log(newArr);
                </code></pre>
                <footer><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array#instance_methods">All
                    array methods on MDN</a></footer>
            </section>

        </section>

        <section>
            <section>
                <h2>09.3<br>Promises</h2>
            </section>
            <section>
                <h2>'Problem'</h2>
                <p>Some code is asynchronous</p>
                <ul>
                    <li>We know when it starts, but not when it's finished</li>
                    <li>The rest of our code doesn't 'wait'</li>
                </ul>
                <pre><code class="hljs javascript">fetchSomeData();
// -&gt; Request new data from the server
// -&gt; We don't know how long that takes...

doSomethingWithThatData();
// -&gt; PROBLEM! We might not have received the data yet!!</code></pre>
            </section>
            <section>
                <h2>Callback functions</h2>
                <pre><code contenteditable class="language-javascript overlayrun">const loadScript = function (src, callback) {
    let script = document.createElement('script');
    script.src = src;
    document.head.append(script);

    // when the script has been loaded
    // -&gt; execute the callback function
    script.onload = () =&gt; callback(script);
}

loadScript(
    'assets/09/someScript.js',
    (script) =&gt; console.log('the script has been loaded')
)
                </code></pre>
                <footer>Callback functions have some issues: deep nesting, difficult error management, &hellip;</footer>
            </section>
            <section>
                <h2>Promises</h2>
                <pre><code contenteditable class="language-javascript overlayrun">let myPromise = new Promise(function (resolve, reject) {
    // do something ...
    setTimeout(() => {
        console.log('tadaa');
        resolve();
    }, 3000)
    // finished doing something? --> resolve()
    // error? --> reject()
});

console.log('Next statement');
</code></pre>
                <br>
                <ul style="width: 85%;font-size: 80%;">
                    <li>When a new Promise is created, the function is started automatically (in parallel)</li>
                    <li>Parameter 1 of the function: <code>resolve</code> is a function on its own, to be called when the code is executed successfully</li>
                    <li>Parameter 2 of the function: <code>reject</code> is a function on its own, to be called when the code encounters some error</li>
                </ul>
            </section>
            <section>
                <h2>Consuming promises (1)</h2>
                <img alt="" src="https://media.giphy.com/media/5eFu67Zi1RQyF3lKMm/giphy.gif">
            </section>
            <section>
                <h2>Consuming promises (2)</h2>
                <pre><code contenteditable class="language-javascript overlayrun">let myPromise = new Promise(function (resolve, reject) {
    setTimeout(() => {
        resolve('tadaa');
    }, 3000)
    // error? --> reject()
});

// consume with 'then'
myPromise
    .then((result) => console.log(result))
    .then(() => console.log('we can chain then() calls'));

console.log('Next statement');
</code></pre>
            </section>
            <section>
                <h2>Then</h2>
                <ul>
                    <li>First argument: onFulfilled</li>
                    <li>Second argument: onRejected (optional)</li>
                    <li>returns a promise</li>
                </ul>
                <pre><code class="hljs js">// consume with 'then'
myPromise
    .then(
        (result) => console.log(result),
        (err) => console.error(err) // same as 'catch'
    )
</code></pre>
            </section>
            <section>
                <h2>Catch</h2>
                <ul>
                    <li>... catches errors or 'reject'</li>
                    <li>is equal to 'then(undefined, onRejected)'</li>
                    <li>returns a promise</li>
                </ul>

                <pre><code class="hljs js">// consume with 'then', 'catch'
myPromise
    .then((result) => console.log(result))
    .catch((err) => console.error(err))
</code></pre>
                <p>ALWAYS add a catch, to prevent uncaught errors</p>
            </section>
            <section>
                <h2>Finally</h2>
                <ul>
                    <li>Just like try { ... } catch { ... } finally { ... }</li>
                    <li>Finally always runs, doesn't matter if the promise is resolved or rejected</li>
                    <li>Has no arguments: passes results and errors to the next handler</li>
                </ul>
                <pre><code class="hljs js">// consume with 'then', 'catch', 'finally'
myPromise
    .then((result) => console.log(result))
    .catch((err) => console.error(err))
    .finally(() => console.log('promise resolved or rejected'))
</code></pre>
            </section>

            <section>
                <h2>Demo</h2>
                <p class="text-14 left">[daughter] — "I promise to clean my room today"<br>
                    [mom] — "Ok. If you do, I'll give you a candy. But if you don't, I'll tell dad about it."</p>
                <pre><code contenteditable class="language-javascript overlayrun">// daughter's promise
let cleanRoom = new Promise((resolve, reject) => {
    // 50% chance that promise is kept
    if (Math.random() > 0.5) resolve();
    else reject();
})

// mom's reactions
cleanRoom
    .then(() => console.log('well done — here is your candy'))
    .catch(() => console.log('boo — I\'ll have to tell dad'));</code></pre>
            </section>
            <section>
                <p>Same but with data passed</p>
                <pre><code contenteditable class="language-javascript overlayrun">// daughter's promise
let cleanRoom = new Promise((resolve, reject) => {
    // 50% chance that promise is kept
    if (Math.random() > 0.5) resolve('chocolate bar');
    else reject('fell asleep');
})

// mom's reactions
cleanRoom
    .then(result => console.log('well done — here is your ' + result))
    .catch(error => console.log('boo — you ' + error));
                </code></pre>
            </section>
            <section>
                <p>Multiple branches</p>
                <pre><code contenteditable class="language-javascript overlayrun">// daughter's promise
let cleanRoom = new Promise((resolve, reject) => {
    if (Math.random() > 0.5) resolve('chocolate bar');
    else reject('fell asleep');
})

// mom's reactions
cleanRoom
    .then(result => console.log('well done'))
    .catch(error => console.log('boo — you ' + error));

// dad's reactions
cleanRoom.catch(() => console.log('Have fun washing the car'));
                </code></pre>
            </section>
            <!--section><p>Chaining</p>
                <pre><code class="hljs js">let fixCar = function () {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            // 50% chance dad fixes the car
            if (Math.random() > 0.5) resolve('car fixed');
            else reject('dad didn\'t find the problem');
        }, 1000)
    })
}

let goToPark = function () {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            // 50% chance of bad weather
            if (Math.random() > 0.5) resolve('the sun is out');
            else reject('too much rain');
        }, 1000)
    })
}

let haveIceCream = function () {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            // 10% chance of no money
            if (Math.random() > 0.1) resolve('yay, ice cream!');
            else reject('can\'t pay');
        }, 1000)
    })
}

fixCar()
    .then(goToPark)
    .then(haveIceCream)
    .then(() => console.log('good day'))
    .catch((err) => console.log(err))
    .finally(() => console.log('bye bye now'));</code></pre>
            </section-->
        </section>




        <!-- The END -->
        <section>
            <section>
                <h2>Questions?</h2>
                <footer>
                    <em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:joris.maervoet@odisee.be">joris.maervoet@odisee.be</a></em>
                </footer>
            </section>
        </section>



    </div>

</div>

<script src="dist/reveal.js"></script>
<script src="plugin/zoom/zoom.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/search/search.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>

    // Also available as an ES module, see:
    // https://revealjs.com/initialization/
    Reveal.initialize({
        controls: true,
        progress: true,
        center: true,
        hash: true,
        slideNumber: true,


        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight ]
    });

</script>
<script src="toc.js"></script>
<script>
    function Incrementable(textField, modifiers, units, options) {
        var me = this;
        this.textField = textField;
        this.step = +textField.getAttribute('step') || +textField.getAttribute('data-step') || 1;
        modifiers = modifiers || {};
        this.modifiers = {
            ctrlKey: modifiers.ctrlKey || 0,
            altKey: modifiers.altKey || 0,
            shiftKey: modifiers.shiftKey || 0
        };

        if (units) {
            this.units = units;
        }

        this.changed = false;

        this.textField.addEventListener('keydown', function(evt) {
            if(me.checkModifiers(evt) && (evt.keyCode == 38 || evt.keyCode == 40)) {
                me.changed = false;

                // Up or down arrow pressed, check if there's something
                // increment/decrement-able where the caret is
                var caret = this.selectionStart || me.getCharacterOffsetWithin(window.getSelection().getRangeAt(0), this), text = this.value || me.stripHTML(this.innerHTML),
                    regex = new RegExp('^([\\s\\S]{0,' + caret + '}[^-0-9\\.])(-?[0-9]*(?:\\.?[0-9]+)(?:' + me.units + '))\\b', 'i');

                if(/^(input|textarea)$/i.test(this.nodeName)) {
                    this.value = this.value.replace(regex, function($0, $1, $2) {
                        if($1.length <= caret && $1.length + $2.length >= caret) {
                            me.changed = true;
                            return $1 + me.stepValue($2, evt.keyCode == 40, evt.shiftKey);
                        }
                        else {
                            return $1 + $2;
                        }
                    });
                } else {
                    this.innerHTML = this.innerHTML.replace(/<br>/gm, "\r\n").replace(/<br\/>/gm, "\r\n").replace(/<br \/>/gm, "\r\n").replace(/<div>/gm, "\r\n").replace(/<\/div>/gm, "");
                    this.innerHTML = me.stripHTML(this.innerHTML).replace(regex, function($0, $1, $2) {
                        if($1.length <= caret && $1.length + $2.length >= caret) {
                            me.changed = true;
                            return $1 + me.stepValue($2, evt.keyCode == 40, evt.shiftKey);
                        }
                        else {
                            return $1 + $2;
                        }
                    }).replace(/</g, '&lt;').replace(/>/g, '&gt;');
                }

                if(me.changed) {
                    if(/^(input|textarea)$/i.test(me.textField.nodeName)) {
                        this.selectionEnd = this.selectionStart = caret;
                    } else {
                        var range = document.createRange();
                        var sel = window.getSelection();
                        range.setStart(me.textField.childNodes[0], caret);
                        // range.collapse(true);
                        sel.removeAllRanges();
                        sel.addRange(range);
                        // el.focus();
                    }
                    evt.preventDefault();
                    evt.stopPropagation();
                }
            }
        }, false);

        this.textField.addEventListener('keypress', function(evt) {
            if(me.changed && me.checkModifiers(evt)
                && (evt.keyCode == 38 || evt.keyCode == 40))
                evt.preventDefault();
            evt.stopPropagation();
            me.changed = false;
        }, false);
    }

    Incrementable.prototype = {
        checkModifiers: function(evt) {
            var m = this.modifiers;

            return m.ctrlKey * evt.ctrlKey + m.altKey * evt.altKey + m.shiftKey * evt.shiftKey >= 3
                || (m.ctrlKey + m.altKey + m.shiftKey == 0);
        },

        /**
         * Gets a <length> and increments or decrements it
         */
        stepValue: function(length, decrement, byChunk) {
            var val = parseFloat(length) + (decrement? -1 : 1) * (byChunk? 10 : 1) * this.step;

            // Prevent rounding errors
            if(this.step % 1) {
                val = (parseFloat(val.toPrecision(12)));
            }

            return val + length.replace(/^-|[0-9]+|\./g, '');
        },

        stripHTML : function(html) {
            var tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent||tmp.innerText;
        },

        getCharacterOffsetWithin : function(range, node) {
            var treeWalker = document.createTreeWalker(
                node,
                NodeFilter.SHOW_TEXT,
                function(node) {
                    var nodeRange = document.createRange();
                    nodeRange.selectNodeContents(node);
                    return nodeRange.compareBoundaryPoints(Range.END_TO_END, range) < 1 ?
                        NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;
                },
                false
            );

            var charCount = 0;
            while (treeWalker.nextNode()) {
                charCount += treeWalker.currentNode.length;
            }
            if (range.startContainer.nodeType == 3) {
                charCount += range.startOffset;
            }
            return charCount;
        },

        units: '|%|deg|px|r?em|ex|ch|in|cm|mm|pt|pc|vm|vw|vh|gd|m?s'
    };
    window.addEventListener('load', function()
    {
        /**
         *
         * Javascript blocks: add run buttons + make incrementable (
         *
         * To use add class 'overlayrun' to the code container
         *
         */

        var jsBlocks = document.querySelectorAll('code.language-javascript');
        for(var i = 0, len = jsBlocks.length; i < len ; i++)
        {

            // Local reference
            var jsBlock = jsBlocks[i];

            // may we add the run button to it?
            if(!jsBlock.className.match(new RegExp('(\\s|^)overlayrun(\\s|$)'))) continue;

            // Add Run button
            var button = document.createElement('input');
            button.type = 'submit';
            button.value = 'Run';
            button.className = 'run';
            var strUseStrict = jsBlock.className.match(new RegExp('(\\s|^)strict(\\s|$)')) ? "'use strict'; " : "";
            button.addEventListener('click', function()
            {
                eval(strUseStrict + stripHTML(this.parentNode.querySelector('code').innerHTML)); // Yeah, that's effin' dangerous!
            });
            jsBlock.parentNode.appendChild(button);

            // Hook ctrl+enter to run the code
            jsBlock.addEventListener('keypress', function(evt)
            {
                if(evt.ctrlKey && (evt.keyCode == 13))
                {
                    evt.preventDefault();
                    evt.stopPropagation();
                    eval(stripHTML(this.innerHTML));
                }
            }, false);

            // Make Incrementable
            new Incrementable(jsBlock);

        }

        /**
         *
         * HTML blocks
         *
         * Add Show in Overlay Button to HTML Blocks
         *
         * To use add class 'overlayrun' to the code container
         *
         */

        var htmlBlocks = document.querySelectorAll('code.language-html');
        for(var i = 0, len = htmlBlocks.length; i < len ; i++)
        {

            // Local reference
            var htmlBlock = htmlBlocks[i];

            // may we add the run button to it?
            if(!htmlBlock.className.match(new RegExp('(\\s|^)overlayrun(\\s|$)'))) continue;

            // Add Run button
            var button = document.createElement('input');
            button.type = 'submit';
            button.value = 'Show in overlay';
            button.className = 'run';
            button.addEventListener('click', function()
            {
                var codeBlock = this.parentNode.querySelector('code');
                showInOverlay(codeBlock, htmlentities(stripHTML(codeBlock.innerHTML)));
            });
            htmlBlock.parentNode.appendChild(button);

            // Hook ctrl+enter to run the code
            htmlBlock.addEventListener('keypress', function(evt)
            {
                if(evt.ctrlKey && (evt.keyCode == 13))
                {
                    evt.preventDefault();
                    evt.stopPropagation();
                    showInOverlay(this, this.innerHTML);
                }
            }, false);

        }

        // show a blob of HTML inside an overlay
        var showInOverlay = function(codeBlock, html, url)
        {
            codeBlock.blur();

            var height = parseInt(codeBlock.getAttribute('data-overlay-height') || 460, 10);
            var width = parseInt(codeBlock.getAttribute('data-overlay-width') || 680, 10);
            var url = url || 'assets/blank.html';

            // Make sure overlay UI elements are present
            if(!document.getElementById('overlayBack'))
            {
                var overlayBack = document.createElement('div');
                overlayBack.id = "overlayBack";
                overlayBack.addEventListener('click', function(e)
                {
                    e.stopPropagation();

                    // erase contents (to prevent movies from playing int he back for example)
                    document.getElementById('daframe').src= 'assets/blank.html';

                    // hide
                    document.getElementById('overlayBack').style.display = 'none';
                    document.getElementById('overlayContent').style.display = 'none';
                });
                document.body.appendChild(overlayBack);
            }

            if(!document.getElementById('overlayContent'))
            {
                var overlayContent = document.createElement('div');
                overlayContent.id = "overlayContent";
                document.body.appendChild(overlayContent);
            }

            // reference elements we'll be needing
            var ob = document.getElementById('overlayBack');
            var oc = document.getElementById('overlayContent');

            // Position oc
            oc.style.width = width + 'px';
            oc.style.height = height + 'px';
            oc.style.marginTop = '-' + (height/2) + 'px';
            oc.style.marginLeft = '-' + (width/2) + 'px';

            // inject iframe
            oc.innerHTML = '<iframe src="' + url + '" height="' + height + '" width="' + width + '" border="0" id="daframe"></iframe>';

            // inject HTML
            if(html)
            {
                var oIframe = document.getElementById('daframe');
                var oDoc = (oIframe.contentWindow || oIframe.contentDocument);
                if(oDoc.document) oDoc = oDoc.document;
                oDoc.write(html_entity_decode(html));
            }

            // Show me the money!
            ob.style.display = 'block';
            oc.style.display = 'block';

        }
        /**
         *
         * Helper functions
         *
         */

        // Helper Function to strip HTML from a string
        function stripHTML(html)
        {
            var tmp = document.createElement('div');
            tmp.innerHTML = html;
            toReturn = tmp.textContent || tmp.innerText;
            tmp = null;
            return toReturn;
        }

        // Helper Function for htmlentities encode
        function htmlentities(str)
        {
            var div = document.createElement('div');
            div.appendChild(document.createTextNode(str));
            return div.innerHTML.replace(/"/g, '"').replace(/'/g, '\'');
        }

        // Helper Function for htmlentities decode
        function html_entity_decode(str)
        {
            var tmp = document.createElement('textarea');
            tmp.innerHTML = str.replace(/</g,"&lt;").replace(/>/g,"&gt;");
            toReturn = tmp.value;
            tmp = null;
            return toReturn;
        }

    });


</script>
</body>
</html>
